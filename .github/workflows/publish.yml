name: 'ðŸ“¤ Publish NuGet packages'

on:
  workflow_call:
    inputs:
      environment:
        description: Name of environment
        type: string
        required: true
        default: prod
    secrets:
      nuget-api-key:
        description: Value of NuGet API key used to upload packages
        required: true

env:
  DOTNET_NOLOGO: true
  DOTNET_CLI_TELEMETRY_OPTOUT: true

defaults:
  run:
    shell: pwsh

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions: {}
    environment:
      name: ${{ inputs.environment }}
    steps:
    - name: ðŸ”½ download packages
      uses: actions/download-artifact@v3
      with:
        name: packages
    - name: ðŸ“¤ push
      run: dotnet nuget push **/*.nupkg  --api-key ${{ secrets.nuget-api-key }} --source "nuget.org" --skip-duplicate
